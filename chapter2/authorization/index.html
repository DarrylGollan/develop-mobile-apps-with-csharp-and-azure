



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/chapter2/authorization/">
      
      
        <meta name="author" content="Adrian Hall">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.3.0">
    
    
      
        <title>Claims and Authorization - Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.572ca0f0.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.962652e9.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../css/vs.css">
    
    
      
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-93366112-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-93366112-1")</script>
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#claims-and-authorization" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/" title="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure
              </span>
              <span class="md-header-nav__topic">
                Claims and Authorization
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/" title="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Chapter 1 - Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Chapter 1 - Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter1/firstapp_pc/" title="Your First App - PC Edition" class="md-nav__link">
      Your First App - PC Edition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter1/firstapp_mac/" title="Your First App - Mac Edition" class="md-nav__link">
      Your First App - Mac Edition
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Chapter 2 - Authentication
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Chapter 2 - Authentication
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../authconcepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../backend/" title="Authentication in the Backend" class="md-nav__link">
      Authentication in the Backend
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/" title="Enterprise Authentication" class="md-nav__link">
      Enterprise Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../social/" title="Social Authentication" class="md-nav__link">
      Social Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../debugging/" title="Debugging Authentication" class="md-nav__link">
      Debugging Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../custom/" title="Custom Authentication" class="md-nav__link">
      Custom Authentication
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Claims and Authorization
      </label>
    
    <a href="./" title="Claims and Authorization" class="md-nav__link md-nav__link--active">
      Claims and Authorization
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#obtaining-user-claims" title="Obtaining User Claims" class="md-nav__link">
    Obtaining User Claims
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authorization" title="Authorization" class="md-nav__link">
    Authorization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-group-claims-to-the-request" title="Adding Group Claims to the Request" class="md-nav__link">
    Adding Group Claims to the Request
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-authorization" title="Group Authorization" class="md-nav__link">
    Group Authorization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../realworld/" title="Tokens in Real Apps" class="md-nav__link">
      Tokens in Real Apps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bestpractices/" title="Best Practices" class="md-nav__link">
      Best Practices
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Chapter 3 - Data Access and Offline Sync
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Chapter 3 - Data Access and Offline Sync
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/dataconcepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/server/" title="Implementing Table Controllers" class="md-nav__link">
      Implementing Table Controllers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/projection/" title="Data Projection and Queries" class="md-nav__link">
      Data Projection and Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/client/" title="The Mobile Client" class="md-nav__link">
      The Mobile Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/relationships/" title="Relationships" class="md-nav__link">
      Relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/domainmgr/" title="The Domain Manager" class="md-nav__link">
      The Domain Manager
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Chapter 4 - Server Side Code
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Chapter 4 - Server Side Code
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter4/options/" title="Options for Server Code" class="md-nav__link">
      Options for Server Code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter4/custom/" title="Custom HTTP Endpoints" class="md-nav__link">
      Custom HTTP Endpoints
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter4/webjobs/" title="WebJobs" class="md-nav__link">
      WebJobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter4/functions/" title="Functions" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter4/recipes/" title="Recipes" class="md-nav__link">
      Recipes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Chapter 5 - Push Notifications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Chapter 5 - Push Notifications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter5/concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter5/android/" title="Android Push" class="md-nav__link">
      Android Push
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter5/ios/" title="iOS Push" class="md-nav__link">
      iOS Push
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter5/windows/" title="Windows Push" class="md-nav__link">
      Windows Push
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter5/recipes/" title="Push Recipes" class="md-nav__link">
      Push Recipes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Chapter 6 - Combining Web and Mobile Apps
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Chapter 6 - Combining Web and Mobile Apps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter6/mvc/" title="MVC Applications" class="md-nav__link">
      MVC Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter6/jquery/" title="jQuery Applications" class="md-nav__link">
      jQuery Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter6/angular/" title="Angular Applications" class="md-nav__link">
      Angular Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter6/react/" title="React Applications" class="md-nav__link">
      React Applications
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Chapter 7 - Other Useful Services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Chapter 7 - Other Useful Services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter7/services/" title="Useful Azure Services" class="md-nav__link">
      Useful Azure Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter7/search/" title="Azure Search" class="md-nav__link">
      Azure Search
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter7/media/" title="Media Services" class="md-nav__link">
      Media Services
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Chapter 8 - Developing An App
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Chapter 8 - Developing An App
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter8/developing/" title="The Development Environment" class="md-nav__link">
      The Development Environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter8/testing/" title="Testing your Application" class="md-nav__link">
      Testing your Application
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Chapter 9 - Going to Production
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Chapter 9 - Going to Production
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter9/arm/" title="Repeatable Deployments" class="md-nav__link">
      Repeatable Deployments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter9/appsvc/" title="Safe Deployments" class="md-nav__link">
      Safe Deployments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter9/monitoring/" title="Monitoring and Troubleshooting" class="md-nav__link">
      Monitoring and Troubleshooting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../xamarin_tips/" title="Xamarin Forms Tips" class="md-nav__link">
      Xamarin Forms Tips
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../android_appendix/" title="Android Developer Notes" class="md-nav__link">
      Android Developer Notes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../vs_extensions/" title="Visual Studio Extensions" class="md-nav__link">
      Visual Studio Extensions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../references/" title="References" class="md-nav__link">
      References
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../credits/" title="Credits" class="md-nav__link">
      Credits
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#obtaining-user-claims" title="Obtaining User Claims" class="md-nav__link">
    Obtaining User Claims
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authorization" title="Authorization" class="md-nav__link">
    Authorization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-group-claims-to-the-request" title="Adding Group Claims to the Request" class="md-nav__link">
    Adding Group Claims to the Request
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-authorization" title="Group Authorization" class="md-nav__link">
    Group Authorization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/edit/master/docs/chapter2/authorization.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="claims-and-authorization">Claims and Authorization<a class="headerlink" href="#claims-and-authorization" title="Permanent link">&para;</a></h1>
<p>Now that we have covered all the techniques for authentication, it's time to look at authorization.  While authentication looked at verifying that a user is who they say they are, authorization looks at if a user is allowed to do a specific operation.</p>
<p>Authorization is handled within the server-side project by the <code>[Authorize]</code> attribute.  Our Azure Mobile Apps backend is leveraging this to provide authorization based on whether a user is authenticated or not.  The Authorize attribute can also check to see if a user is in a list of users or roles.  However, there is a problem with this.  The user id is not guessable and we have no roles.  To see what I mean, run the <strong>Backend</strong> project locally and set a break point on the <code>GetAllTodoItems()</code> method in the <code>TodoItemController</code>, then run your server and your UWP application.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Once you have built and deployed the UWP application, it will appear in your normal Application list.  This allows you to run the application and the server at the same time on the same machine.</p>
</div>
<p>Once you have authenticated, you will be able to set a break point to take a look at <code>this.User.Identity</code>:</p>
<p><img alt="this.User.Identity output" src="../img/user-identity.PNG" /></p>
<p>Note that the <code>Name</code> property is null.  This is the property that is used when you want to authorize individual users. Expand the <code>Claims</code> property and then click on <strong>Results View</strong>:</p>
<p><img alt="Claims output" src="../img/user-claims.PNG" /></p>
<p>The only claims are the ones in the token, and none of them match the <code>RoleClaimType</code>, so we can't use roles either. Clearly, we are going to have to do something else.</p>
<h2 id="obtaining-user-claims">Obtaining User Claims<a class="headerlink" href="#obtaining-user-claims" title="Permanent link">&para;</a></h2>
<p>At some point you are going to need to deal with something other than the claims that are in the token passed for authentication.  Fortunately, the Authentication / Authorization feature has an endpoint for that at <code>/.auth/me</code>:</p>
<p><img alt="The /.auth/me endpoint" src="../img/auth-me.PNG" /></p>
<p>Of course, the <code>/.auth/me</code> endpoint is not of any use if you cannot access it.  The most use of this information is gained during authorization on the server and we will cover this use later on.  However, there are reasons to pull this information on the client as well.  For example, we may want to make the List View title be our name instead of
"Tasks".</p>
<div class="admonition warn">
<p class="admonition-title">Warn</p>
<p>You can't use the /.auth/me endpoint when using custom authentication.</p>
</div>
<p>Since identity provider claims can be anything, they are transferred as a list within a JSON object.  Before we can decode the JSON object, we need to define the models.  This is done in the shared <strong>TaskList</strong> project.  I've defined this in <code>Models\AppServiceIdentity.cs</code>.</p>
<pre><code class="csharp">using System.Collections.Generic;
using Newtonsoft.Json;

namespace TaskList.Models
{
    public class AppServiceIdentity
    {
        [JsonProperty(PropertyName = &quot;id_token&quot;)]
        public string IdToken { get; set; }

        [JsonProperty(PropertyName = &quot;provider_name&quot;)]
        public string ProviderName { get; set; }

        [JsonProperty(PropertyName = &quot;user_id&quot;)]
        public string UserId { get; set; }

        [JsonProperty(PropertyName = &quot;user_claims&quot;)]
        public List&lt;UserClaim&gt; UserClaims { get; set; }
    }

    public class UserClaim
    {
        [JsonProperty(PropertyName = &quot;typ&quot;)]
        public string Type { get; set; }

        [JsonProperty(PropertyName = &quot;val&quot;)]
        public string Value { get; set; }
    }
}
</code></pre>

<p>This matches the JSON format from the <code>/.auth/me</code> call we did earlier.   This is going to be a part of the ICloudService as follows:</p>
<pre><code class="csharp">using System.Threading.Tasks;
using TaskList.Models;

namespace TaskList.Abstractions
{
    public interface ICloudService
    {
        ICloudTable&lt;T&gt; GetTable&lt;T&gt;() where T : TableData;

        Task LoginAsync();

        Task LoginAsync(User user);

        Task&lt;AppServiceIdentity&gt; GetIdentityAsync();
    }
}
</code></pre>

<p>Finally, we need to actually implement the concrete version in <code>AzureCloudService.cs</code>:</p>
<pre><code class="csharp">List&lt;AppServiceIdentity&gt; identities = null;

public async Task&lt;AppServiceIdentity&gt; GetIdentityAsync()
{
    if (client.CurrentUser == null || client.CurrentUser?.MobileServiceAuthenticationToken == null)
    {
        throw new InvalidOperationException(&quot;Not Authenticated&quot;);
    }

    if (identities == null)
    {
        identities = await client.InvokeApiAsync&lt;List&lt;AppServiceIdentity&gt;&gt;(&quot;/.auth/me&quot;);
    }

    if (identities.Count &gt; 0)
        return identities[0];
    return null;
}
</code></pre>

<p>Note that there is no reason to instantiate your own <code>HttpClient()</code>.  The Azure Mobile Apps SDK has a method for invoking custom API calls (as we shall see later on).  However, if you prefix the path with a slash, it will execute a HTTP GET for any API with any authentication that is currently in force.  We can leverage this to call the <code>/.auth/me</code> endpoint and decode the response in one line of code.  Adjust the <code>ExecuteRefreshCommand()</code> method in the <code>ViewModels\TaskListViewModel.cs</code> file to take advantage of this:</p>
<pre><code class="csharp">async Task ExecuteRefreshCommand()
{
    if (IsBusy)
        return;
    IsBusy = true;

    try
    {
        var identity = await cloudService.GetIdentityAsync();
        if (identity != null)
        {
            var name = identity.UserClaims.FirstOrDefault(c =&gt; c.Type.Equals(&quot;name&quot;)).Value;
            Title = $&quot;Tasks for {name}&quot;;
        }
        var list = await Table.ReadAllItemsAsync();
        Items.ReplaceRange(list);
    }
    catch (Exception ex)
    {
        await Application.Current.MainPage.DisplayAlert(&quot;Items Not Loaded&quot;, ex.Message, &quot;OK&quot;);
    }
    finally
    {
        IsBusy = false;
    }
}
</code></pre>

<p>The return value from the <code>GetIdentityAsync()</code> method is the first identity.  Normally, a user would only authenticate once, so this is fairly safe.  The number of claims returned depends on the identity provider and could easily number in the hundreds.  Even the default configuration for Azure Active Directory returns 18 claims.  These are easily handled using LINQ, however.  The <code>Type</code> property holds the type.  This could be a short (common) name.  It could also be a schema name, which looks more like a URI.  The only way to know what claims are coming back for sure is to look at the <code>/.auth/me</code> result with something like Postman.</p>
<div class="admonition warn">
<p class="admonition-title">Warn</p>
<p>If you are using Custom Authentication (e.g. username/password or a third-party token), then the <code>/.auth/me</code>    endpoint is not available to you.  You can still produce a custom API in your backend to provide this information to your client, but you are responsible for the code - it's custom, after all!</p>
</div>
<h2 id="authorization">Authorization<a class="headerlink" href="#authorization" title="Permanent link">&para;</a></h2>
<p>Now that we have covered all the techniques for authentication, it's time to look at authorization.  While authentication looked at verifying that a user is who they say they are, authorization looks at if a user is allowed to do a specific operation.</p>
<p>Authorization is handled within the server-side project by the <code>[Authorize]</code> attribute.  Our Azure Mobile Apps backend is leveraging this to provide authorization based on whether a user is authenticated or not.  The Authorize attribute can also check to see if a user is in a list of users or roles.  However, there is a problem with this.  The user id is not guessable and we have no roles.  To see what I mean, run the <strong>Backend</strong> project and set a break point on the <code>GetAllTodoItems()</code> method in the <code>TodoItemController</code>, then run your server and your UWP application.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Once you have built and deployed the UWP application, it will appear in your normal Application list.  This allows you to run the application and the server at the same time on the same machine.  Alternatively, you can attach a Debugger to your Azure App Service within Visual Studio's Cloud Explorer.</p>
</div>
<p>Once you have authenticated, you will be able to set a break point to take a look at <code>this.User.Identity</code>:</p>
<p><img alt="this.User.Identity output" src="../img/user-identity.PNG" /></p>
<p>Note that the <code>Name</code> property is null.  This is the property that is used when you want to authorize individual users.  Expand the <code>Claims</code> property and then click on <strong>Results View</strong>:</p>
<p><img alt="Claims output" src="../img/user-claims.PNG" /></p>
<p>The only claims are the ones in the token, and none of them match the <code>RoleClaimType</code>, so we can't use roles either.  Clearly, we are going to have to do something else.  Fortunately, we already know that we can get some information about the identity provider claims from the <code>/.auth/me</code> endpoint.  To get the extra information, we need to query the <code>User</code> object:</p>
<pre><code class="csharp">var identity = await User.GetAppServiceIdentityAsync&lt;AzureActiveDirectoryCredentials&gt;(Request);
</code></pre>

<p>There is one <code>Credentials</code> class for each supported authentication technique - Azure Active Directory, Facebook, Google, Microsoft Account and Twitter.  These are in the <strong>Microsoft.Azure.Mobile.Server.Authentication</strong> namespace.  They all follow the same pattern as the model we created for the client - there are Provider, UserId and UserClaims properties.  The token and any special information will be automatically decoded for you.  For instance, the TenantId is pulled out of the response for Azure AD.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can use the AccessToken property to do Graph API lookups for most providers.  Use the Graph SDK provided by the authentication provider for this purpose; either in the mobile backend or the client.</p>
</div>
<h2 id="adding-group-claims-to-the-request">Adding Group Claims to the Request<a class="headerlink" href="#adding-group-claims-to-the-request" title="Permanent link">&para;</a></h2>
<p>There are times when you want to add something else to the token that is returned from Azure AD. The most common requirement is to add group information to the response so you can handle group-based authorization.</p>
<p>To add security groups to the Azure AD token:</p>
<ol>
<li>Log into the <a href="https://portal.azure.com/">Azure Portal</a>.</li>
<li>Click on <strong>Azure Active Directory</strong> in your left-hand menu (you may need to search for it).</li>
<li>If you need to work in a different directory, click <strong>Switch directory</strong> to do so.</li>
<li>Click <strong>App registrations</strong>.</li>
<li>Click your WEB application.</li>
<li>Click <strong>Manifest</strong> at the top of the registered app blade.</li>
<li>
<p>You are now placed within a manifest editor.  Find the <strong>groupMembershipClaims</strong> entry and change it from null to <strong>"SecurityGroup"</strong>.</p>
<p><img alt="AAD Security Group - Change1" src="../img/aad-ibiza-editmanifest.PNG" /></p>
</li>
<li>
<p>When complete, click <strong>Save</strong>.</p>
</li>
</ol>
<p>You can now give the web application additional permissions:</p>
<ol>
<li>Close the Manifest editor.</li>
<li>Click <strong>Settings</strong>.</li>
<li>Click <strong>Required permissions</strong>.</li>
<li>Click <strong>Windows Azure Active Directory</strong>.</li>
<li>Click <strong>Read directory data</strong> under the <strong>Delegated Permissions</strong> section.</li>
<li>Scroll to the bottom, click on <strong>Delegated Permissions</strong>.</li>
<li>Check the box for <strong>Read directory data</strong>.</li>
</ol>
<p><img alt="AAD: Group Permissions" src="../img/aad-group-perms.PNG" /></p>
<ol>
<li>Click on <strong>Save</strong>.</li>
</ol>
<p>If you are not an administrator of the domain, then an administrator will need to approve your request.  Now that you have configured the application to return groups as part of the claims, you should probably add a couple of groups:</p>
<ol>
<li>Click <strong>Azure Active Directory</strong> in the left-hand menu to return to the top-level.</li>
<li>Click <strong>Users and groups</strong>.</li>
<li>Click <strong>All groups</strong>.</li>
<li>Click <strong>+ Add</strong>.</li>
<li>Fill in the information, then click <strong>Create</strong>.</li>
</ol>
<p><img alt="AAD: Add Group" src="../img/aad-group-1.PNG" /></p>
<ol>
<li>Click on the new group.</li>
</ol>
<p><img alt="AAD: Group Properties" src="../img/aad-group-2.PNG" /></p>
<ol>
<li>Make a note of the <strong>OBJECT ID</strong>.  The claims for groups are listed by the Object ID, so you will need this to
   refer to the group later.</li>
</ol>
<p>It's a good idea to add a couple of groups for testing purposes.  If you are using the organization directory, you will need to request the creation of a couple of groups for application roles.  The view of the groups will be shown when we get the identity of the user using <code>User.GetAppServiceIdentityAsync&lt;AzureActiveDirectoryCredentials&gt;(Request)</code>:</p>
<p><img alt="AAD: Group in Claims" src="../img/aad-groups-views.PNG" /></p>
<h3 id="group-authorization">Group Authorization<a class="headerlink" href="#group-authorization" title="Permanent link">&para;</a></h3>
<p>Now that we have group claims in the claims list for the <code>/.auth/me</code> endpoint, we can move forward to do authorization
based on these claims.  This can be done in a relatively basic manner by implementing a method to check the claims:</p>
<pre><code class="csharp">async Task&lt;bool&gt; IsAuthorizedAsync()
{
    var identity = await User.GetAppServiceIdentityAsync&lt;AzureActiveDirectoryCredentials&gt;(Request);
    var countofGroups = identity.UserClaims
        .Where(c =&gt; c.Type.Equals(&quot;groups&quot;) &amp;&amp; c.Value.Equals(&quot;01f214a9-af1f-4bdd-938f-3f16749aef0e&quot;))
        .Count();
    return (countofGroups &gt; 0);
}
</code></pre>

<p>The <code>UserClaims</code> object is an <code>IEnumerable</code> that contains objects with a Type and a Value.  The Type for the group claims is <code>groups</code>.  Once we have this knowledge, we can use a LINQ query to obtain a count of the claims that match the conditions we want to test.  The Value we use is the Object ID of the group.  This is available in the <strong>PROPERTIES</strong> tab of the group.</p>
<p>We can prevent a new record being added by adjusting the <code>PostTodoItem()</code> method:</p>
<pre><code class="csharp">public async Task&lt;IHttpActionResult&gt; PostTodoItem(TodoItem item)
{
    if (!await IsAuthorizedAsync())
    {
        return Unauthorized();
    }
    TodoItem current = await InsertAsync(item);
    return CreatedAtRoute(&quot;Tables&quot;, new { id = current.Id }, current);
}
</code></pre>

<p>Unfortunately, most of the table controller methods do not return an <code>IHttpActionResult</code>, so this has limited value.  What would be better would be an <code>[Authorize]</code> attribute that tests the claims for us.  For instance, we should be able to do the following:</p>
<pre><code class="csharp">[AuthorizeClaims(&quot;groups&quot;, &quot;01f214a9-af1f-4bdd-938f-3f16749aef0e&quot;)]
public async Task&lt;IHttpActionResult&gt; PostTodoItem(TodoItem item)
{
    TodoItem current = await InsertAsync(item);
    return CreatedAtRoute(&quot;Tables&quot;, new { id = current.Id }, current);
}
</code></pre>

<p>The <code>[AuthorizeClaims()]</code> attribute does not exist, so we have to provide it ourselves:</p>
<pre><code class="csharp">using System.Linq;
using System.Net;
using System.Security.Principal;
using System.Threading;
using System.Threading.Tasks;
using System.Web.Http;
using System.Web.Http.Controllers;
using System.Web.Http.Filters;
using Microsoft.Azure.Mobile.Server.Authentication;

namespace Backend.Helpers
{
    public class AuthorizeClaimsAttribute : AuthorizationFilterAttribute
    {
        string Type { get; }
        string Value { get; }

        public AuthorizeClaimsAttribute(string type, string value)
        {
            Type = type;
            Value = value;
        }

        public override async Task OnAuthorizationAsync(HttpActionContext actionContext, CancellationToken cancellationToken)
        {
            var request = actionContext.Request;
            var user = actionContext.RequestContext.Principal;
            if (user != null)
            {
                var identity = await user.GetAppServiceIdentityAsync&lt;AzureActiveDirectoryCredentials&gt;(request);
                var countOfMatchingClaims = identity.UserClaims
                    .Where(c =&gt; c.Type.Equals(Type) &amp;&amp; c.Value.Equals(Value))
                    .Count();
                if (countOfMatchingClaims &gt; 0) return;

            }
            throw new HttpResponseException(HttpStatusCode.Unauthorized);
        }
    }
}
</code></pre>

<p>This is the same type of authorization filter attribute that the officially provided <code>AuthorizeAttribute</code> is based on.  However, the AuthorizeAttribute is synchronous.  We require an asynchronous version of the attribute, so we cannot use a sub-class of the AuthorizeAttribute.  Aside from that note, this uses virtually the same code that we used in the <code>IsAythorizedAsync()</code> method we developped earlier.</p>
<p>We can now use this attribute for testing any claim.  For example, our claims has the identity provider as a claim.  We can use the following:</p>
<pre><code class="csharp">[AuthorizeClaims(&quot;http://schemas.microsoft.com/identity/claims/identityprovider&quot;, &quot;live.com&quot;)]
</code></pre>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you want to test other claims that are not provided, you can enable the <strong>Read Directory Data</strong> permission in the Azure Active Directory permissions and do a query against the Azure Active Directory.  You should think about caching results or minting a new ZUMO token (just like we did in the custom authentication case) for performance reasons.</p>
</div>
<!-- Images -->

<!-- Links -->
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../custom/" title="Custom Authentication" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Custom Authentication
              </span>
            </div>
          </a>
        
        
          <a href="../realworld/" title="Tokens in Real Apps" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Tokens in Real Apps
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 Adrian Hall
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/adrianhall" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/FizzyInTheHall" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.a353778b.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../js/highlight.pack.js"></script>
      
    
  </body>
</html>