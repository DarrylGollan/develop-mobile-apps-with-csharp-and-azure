



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/chapter4/custom/">
      
      
        <meta name="author" content="Adrian Hall">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.3.0">
    
    
      
        <title>Custom HTTP Endpoints - Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.572ca0f0.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.962652e9.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../css/vs.css">
    
    
      
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-93366112-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-93366112-1")</script>
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#custom-http-endpoints" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/" title="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure
              </span>
              <span class="md-header-nav__topic">
                Custom HTTP Endpoints
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/" title="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Chapter 1 - Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Chapter 1 - Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter1/firstapp_pc/" title="Your First App - PC Edition" class="md-nav__link">
      Your First App - PC Edition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter1/firstapp_mac/" title="Your First App - Mac Edition" class="md-nav__link">
      Your First App - Mac Edition
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Chapter 2 - Authentication
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Chapter 2 - Authentication
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/authconcepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/backend/" title="Authentication in the Backend" class="md-nav__link">
      Authentication in the Backend
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/enterprise/" title="Enterprise Authentication" class="md-nav__link">
      Enterprise Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/social/" title="Social Authentication" class="md-nav__link">
      Social Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/debugging/" title="Debugging Authentication" class="md-nav__link">
      Debugging Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/custom/" title="Custom Authentication" class="md-nav__link">
      Custom Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/authorization/" title="Claims and Authorization" class="md-nav__link">
      Claims and Authorization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/realworld/" title="Tokens in Real Apps" class="md-nav__link">
      Tokens in Real Apps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/bestpractices/" title="Best Practices" class="md-nav__link">
      Best Practices
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Chapter 3 - Data Access and Offline Sync
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Chapter 3 - Data Access and Offline Sync
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/dataconcepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/server/" title="Implementing Table Controllers" class="md-nav__link">
      Implementing Table Controllers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/projection/" title="Data Projection and Queries" class="md-nav__link">
      Data Projection and Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/client/" title="The Mobile Client" class="md-nav__link">
      The Mobile Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/relationships/" title="Relationships" class="md-nav__link">
      Relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/domainmgr/" title="The Domain Manager" class="md-nav__link">
      The Domain Manager
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Chapter 4 - Server Side Code
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Chapter 4 - Server Side Code
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../options/" title="Options for Server Code" class="md-nav__link">
      Options for Server Code
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Custom HTTP Endpoints
      </label>
    
    <a href="./" title="Custom HTTP Endpoints" class="md-nav__link md-nav__link--active">
      Custom HTTP Endpoints
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuring-custom-apis" title="Configuring Custom APIs" class="md-nav__link">
    Configuring Custom APIs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-basic-custom-api" title="Creating a Basic Custom API" class="md-nav__link">
    Creating a Basic Custom API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-parameters-to-a-custom-api" title="Handling Parameters to a Custom API" class="md-nav__link">
    Handling Parameters to a Custom API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-post-requests" title="Handling POST Requests" class="md-nav__link">
    Handling POST Requests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-downside-of-custom-apis" title="The Downside of Custom APIs" class="md-nav__link">
    The Downside of Custom APIs
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../webjobs/" title="WebJobs" class="md-nav__link">
      WebJobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../functions/" title="Functions" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../recipes/" title="Recipes" class="md-nav__link">
      Recipes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Chapter 5 - Push Notifications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Chapter 5 - Push Notifications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter5/concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter5/android/" title="Android Push" class="md-nav__link">
      Android Push
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter5/ios/" title="iOS Push" class="md-nav__link">
      iOS Push
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter5/windows/" title="Windows Push" class="md-nav__link">
      Windows Push
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter5/recipes/" title="Push Recipes" class="md-nav__link">
      Push Recipes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Chapter 6 - Combining Web and Mobile Apps
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Chapter 6 - Combining Web and Mobile Apps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter6/mvc/" title="MVC Applications" class="md-nav__link">
      MVC Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter6/jquery/" title="jQuery Applications" class="md-nav__link">
      jQuery Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter6/angular/" title="Angular Applications" class="md-nav__link">
      Angular Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter6/react/" title="React Applications" class="md-nav__link">
      React Applications
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Chapter 7 - Other Useful Services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Chapter 7 - Other Useful Services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter7/services/" title="Useful Azure Services" class="md-nav__link">
      Useful Azure Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter7/search/" title="Azure Search" class="md-nav__link">
      Azure Search
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter7/media/" title="Media Services" class="md-nav__link">
      Media Services
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Chapter 8 - Developing An App
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Chapter 8 - Developing An App
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter8/developing/" title="The Development Environment" class="md-nav__link">
      The Development Environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter8/testing/" title="Testing your Application" class="md-nav__link">
      Testing your Application
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Chapter 9 - Going to Production
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Chapter 9 - Going to Production
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter9/arm/" title="Repeatable Deployments" class="md-nav__link">
      Repeatable Deployments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter9/appsvc/" title="Safe Deployments" class="md-nav__link">
      Safe Deployments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter9/monitoring/" title="Monitoring and Troubleshooting" class="md-nav__link">
      Monitoring and Troubleshooting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../xamarin_tips/" title="Xamarin Forms Tips" class="md-nav__link">
      Xamarin Forms Tips
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../android_appendix/" title="Android Developer Notes" class="md-nav__link">
      Android Developer Notes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../vs_extensions/" title="Visual Studio Extensions" class="md-nav__link">
      Visual Studio Extensions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../references/" title="References" class="md-nav__link">
      References
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../credits/" title="Credits" class="md-nav__link">
      Credits
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuring-custom-apis" title="Configuring Custom APIs" class="md-nav__link">
    Configuring Custom APIs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-basic-custom-api" title="Creating a Basic Custom API" class="md-nav__link">
    Creating a Basic Custom API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-parameters-to-a-custom-api" title="Handling Parameters to a Custom API" class="md-nav__link">
    Handling Parameters to a Custom API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-post-requests" title="Handling POST Requests" class="md-nav__link">
    Handling POST Requests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-downside-of-custom-apis" title="The Downside of Custom APIs" class="md-nav__link">
    The Downside of Custom APIs
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/edit/master/docs/chapter4/custom.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="custom-http-endpoints">Custom HTTP Endpoints<a class="headerlink" href="#custom-http-endpoints" title="Permanent link">&para;</a></h1>
<p>Azure Mobile Apps makes it really easy to develop basic APIs that can be used in mobile clients.  Most
custom APIs can be simply invoked.  Azure Mobile Apps takes care of most of the scaffolding for you. The
server SDK will:</p>
<ul>
<li>Ensure the <code>ZUMO-API-VERSION</code> is present and valid.</li>
<li>Handle serialization and deserialization of JSON.</li>
<li>Ensure the API is given an appropriate URL.</li>
</ul>
<p>All the custom APIs will appear under the <code>/api</code> endpoint.  For example, if you created a controller
called <code>FooController</code>, it would be invoked by sending messages to <code>/api/Foo</code>.  This is case-insensitive,
so you could also reference this API as <code>/api/foo</code>.</p>
<h3 id="configuring-custom-apis">Configuring Custom APIs<a class="headerlink" href="#configuring-custom-apis" title="Permanent link">&para;</a></h3>
<p>Before anything happens, you must add the <code>MapApiControllers()</code> method to the <code>MobileAppConfiguration()</code>
call.  This is done in the <code>ConfigureMobileApp()</code> method in <code>App_Start\Startup.MobileApp.cs</code> file:</p>
<pre><code class="csharp">    new MobileAppConfiguration()
        .AddTablesWithEntityFramework()     /* /tables endpoints */
        .MapApiControllers()                /* /api endpoints */
        .ApplyTo(config);
</code></pre>

<p>The <code>MapApiControllers()</code> extension method does the actual work of looking for custom APIs and mapping them
onto the <code>/api</code> endpoint.</p>
<h3 id="creating-a-basic-custom-api">Creating a Basic Custom API<a class="headerlink" href="#creating-a-basic-custom-api" title="Permanent link">&para;</a></h3>
<p>You might remember that the original Azure Mobile Apps project within Visual Studio comes with a sample
custom API called the <code>ValuesController</code>.  This controller did not do anything useful.  Let's re-create
it from scratch.</p>
<ul>
<li>Right-click the <code>Controllers</code> node in your backend project and use <strong>Add</strong> -&gt; <strong>Controller...</strong>.</li>
</ul>
<p><img alt="" src="../img/add-custom-controller-1.PNG" /></p>
<ul>
<li>Select the <strong>Azure Mobile Apps Custom Controller</strong>, then click <strong>Add</strong>.</li>
<li>Enter the name for the controller, for example, <strong>ValuesController</strong>.  Click <strong>Add</strong>.</li>
</ul>
<p>The new controller will be scaffolded for you.  When you are done, it looks like this:</p>
<pre><code class="csharp">using System.Web.Http;
using Microsoft.Azure.Mobile.Server.Config;

namespace Backend.Controllers
{
    [MobileAppController]
    public class ValuesController : ApiController
    {
        // GET api/Default
        public string Get()
        {
            return &quot;Hello from custom controller!&quot;;
        }
    }
}
</code></pre>

<p>If you have not done anything that requires a backend, then you can press F5 to run the backend and use
Postman to interact with your new custom API:</p>
<p><img alt="" src="../img/add-custom-controller-2.PNG" /></p>
<p>We still have to submit the <code>ZUMO-API-VERSION</code> header for this to work.  Whatever my method returns will
be returned as JSON.  This one is not exactly exciting.  One of the things I do quite often is provide
a configuration endpoint called <code>/api/config</code> which returns a JSON object that I can use to configure the
mobile client.</p>
<pre><code class="csharp">using System.Web.Http;
using Microsoft.Azure.Mobile.Server.Config;
using System.Collections.Generic;
using System;

namespace Backend.Controllers
{
    [MobileAppController]
    public class ConfigController : ApiController
    {
        private ConfigViewModel configuration;

        public ConfigController()
        {
            Dictionary&lt;string, ProviderInformation&gt; providers = new Dictionary&lt;string, ProviderInformation&gt;();

            AddToProviders(providers, &quot;aad&quot;, &quot;MOBILE_AAD_CLIENT_ID&quot;);
            AddToProviders(providers, &quot;facebook&quot;, &quot;MOBILE_FB_CLIENT_ID&quot;);
            AddToProviders(providers, &quot;google&quot;, &quot;MOBILE_GOOGLE_CLIENT_ID&quot;);
            AddToProviders(providers, &quot;microsoftaccount&quot;, &quot;MOBILE_MSA_CLIENT_ID&quot;);
            AddToProviders(providers, &quot;twitter&quot;, &quot;MOBILE_TWITTER_CLIENT_ID&quot;);

            configuration = new ConfigViewModel
            {
                AuthProviders = providers
            };
        }

        private void AddToProviders(Dictionary&lt;string, ProviderInformation&gt; providers, string provider, string envVar)
        {
            string envVal = Environment.GetEnvironmentVariable(envVar);
            if (envVal != null &amp;&amp; envVal?.Length &gt; 0)
            {
                providers.Add(provider, new ProviderInformation { ClientId = envVal });
            }

        }

        [HttpGet]
        public ConfigViewModel Get()
        {
            return configuration;
        }
    }

    public class ProviderInformation
    {
        public string ClientId { get; set; }
    }

    public class ConfigViewModel
    {
        public Dictionary&lt;string, ProviderInformation&gt; AuthProviders { get; set; }
    }
}
</code></pre>

<p>The constructor produces a <code>ConfigViewModel</code> for me.  This describes the configuration object I want to send.  In
this case, I want to send the client ID for each authentication provider.  If the authentication provider is not
configured, then the client ID is not sent.  I use the application settings to determine what is configured. The
primary idea behind this is to integrate all the client flows within my mobile client.  When the user wishes to
log in, they are presented with a menu of options and can pick which social provider they wish to use.  The
client-flow authentication libraries may use different client IDs than the ones that are configured into the authentication
service.  For example, AAD uses two client IDs - one for server-flow and one for client-flow.  As a result, this
controller uses <strong>Application Settings</strong> (which appear as environment variables to the backend) to set the
client IDs.  The result of calling this API from Postman looks like this:</p>
<p><img alt="" src="../img/add-custom-controller-3.PNG" /></p>
<div class="admonition warn">
<p class="admonition-title">Warn</p>
<p>Only expose information that you would normally and reasonably embed in a mobile client.  Never transmit
secrets this way.  It is insecure and can put your entire authentication system at risk of hijack.</p>
</div>
<p>You can read this information using the Azure Mobile Apps Client SDK once you have a client reference, using
the same model classes:</p>
<pre><code class="csharp">var configuration = await client.InvokeAsync&lt;ConfigViewModel&gt;(&quot;config&quot;, HttpMethod.Get, null);
</code></pre>

<p>You must specify a class that deserializes the JSON that is produced by your API.  If you use the same classes,
that is practically guaranteed.  The other methods in call are the HTTP Method (GET, POST, PATCH, DELETE, etc.)
and the query parameters.</p>
<h3 id="handling-parameters-to-a-custom-api">Handling Parameters to a Custom API<a class="headerlink" href="#handling-parameters-to-a-custom-api" title="Permanent link">&para;</a></h3>
<p>The <code>/api/config</code> endpoint didn't require any information that is extra.  Sometimes, we need to provide
extra information so that the right thing can be produced.  For example, consider the case of uploading
or downloading a file to Azure Storage.  We may want to provide some extra information - the filename of
the file we want to upload and the permissions for the file.  Uploading and downloading files is discussed
more fully <a href="../recipes/">later</a> in the book and offers a fuller example of this concept.</p>
<p>To illustrate the concept clearly, let's create an API that adds two numbers together.  We would call
this API through HTTP like this: <code>GET /api/addition?first=1&amp;second=2</code>.  The first number gets added to
the second number and we will return the result.  If the first or the second number doesn't exist, we
want to produce a 400 Bad Request response rather than crashing the server.  Here is the code:</p>
<pre><code class="csharp">using System.Web.Http;
using Microsoft.Azure.Mobile.Server.Config;
using System.Net;

namespace Backend.Controllers
{
    [MobileAppController]
    public class AdditionController : ApiController
    {
        // GET api/Addition
        public ResultViewModel Get(int? first, int? second)
        {
            if (first == null || second == null)
            {
                throw new HttpResponseException(HttpStatusCode.BadRequest);
            }
            ResultViewModel results = new ResultViewModel
            {
                First = first.GetValueOrDefault(),
                Second = second.GetValueOrDefault()
            };
            results.Result = results.First + results.Second;
            return results;
        }
    }

    public class ResultViewModel
    {
        public int First { get; set; }
        public int Second { get; set; }
        public int Result { get; set; }
    }
}
</code></pre>

<p>If you try this out, you will notice something rather odd.  Try doing the following URL: <code>/api/addition?first=1&amp;second=2</code>.
You will note it works as expected.  However, if you try doing the following URL: <code>/api/addition?first=1</code>, then you
will note that you get a <strong>404 Not Found</strong>.  This makes the API easy to write because you don't have to worry about
your code receiving bad input (most of the time).  However, you may not get the API surface that you want.  In this
case, I want to return a <strong>400 Bad Request</strong> instead of the normal 404 response.  I have to do a lot more work to
support this case:</p>
<pre><code class="csharp">    public class AdditionController : ApiController
    {
        // GET api/Addition
        public ResultViewModel Get()
        {
            int? first = GetParameter(Request, &quot;first&quot;),
                 second = GetParameter(Request, &quot;second&quot;);

            ResultViewModel results = new ResultViewModel
            {
                First = first.GetValueOrDefault(),
                Second = second.GetValueOrDefault()
            };
            results.Result = results.First + results.Second;
            return results;
        }

        private int? GetParameter(HttpRequestMessage request, string name)
        {
            var queryParams = request.GetQueryNameValuePairs().Where(kv =&gt; kv.Key == name).ToList();
            if (queryParams.Count == 0)
            {
                throw new HttpResponseException(HttpStatusCode.BadRequest);
            }

            int rv;
            if (!Int32.TryParse(queryParams[0].Value, out rv))
            {
                throw new HttpResponseException(HttpStatusCode.BadRequest);
            }
            return rv;
        }
    }
</code></pre>

<p>When our Get() routine does not take parameters, no particular pattern is required.  We can use the <code>Request</code>
object to access the parameters we send.  In this case, the <code>GetParameter()</code> routine checks to see if there
is a named parameter and converts it to an integer.  If the named parameter is not there or it is not numeric,
then a Bad Request response is sent.</p>
<h3 id="handling-post-requests">Handling POST Requests<a class="headerlink" href="#handling-post-requests" title="Permanent link">&para;</a></h3>
<p>GET and DELETE requests take parameters on the URI.  These can be dealt with via the automatic conversion to
method parameters or they can be handled via LINQ queries on the request object, as we observed in the prior
section.  POST requests, by contrast, allow you to submit a JSON body for processing.  This is useful when we
want to submit multiple JSON objects for processing.  For example, one of the common requirements we have is
for transactions.  When we want to submit two objects that are joined by a foreign key, we can submit them
both and construct a transaction in the backend with Entity Framework.</p>
<p>Let's take an example.  We want to produce a music trakcing mobile app.  When we add an album to our music
database, we also want to add the tracks for that database.  This can be modeled with code first Entity
Framework:</p>
<pre><code class="csharp">public class Track : EntityData
{
    public Track() {}

    public string Title { get; set; }
    public int Length { get; set; }

    public virtual Album Album { get; set; }
}

public class Album : EntityData
{
    public Album()
    {
        Tracks = new List&lt;Track&gt;();
    }

    public string Title { get; set; }

    public virtual ICollection&lt;Track&gt; Tracks { get; set; }
}
</code></pre>

<p>This will generate a foreign key relationship in the tables of our database.  However, as we learned in
<a href="../../chapter3/relationships/">chapter 3</a>, relationships are hard to implement and come with some serious caveats.  We could decouple
the tracks from the albums, but let's instead try to insert the data for an album all in one go.  We do
this by submitting the JSON for an Album to a custom controller:</p>
<pre><code class="csharp">    [MobileAppController]
    public class AlbumCustomController : ApiController
    {
        MobileServiceContext context;

        public AlbumCustomController() : base()
        {
            context = new MobileServiceContext();
        }

        [HttpPost]
        public async Task&lt;AlbumCustomResponse&gt; PostAsync([FromBody] Album newAlbum)
        {
            // Use a transaction to update the database
            using (DbContextTransaction transaction = context.Database.BeginTransaction())
            {
                try
                {
                    context.Albums.Add(newAlbum);
                    await context.SaveChangesAsync();
                    transaction.Commit();
                }
                catch (Exception ex)
                {
                    transaction.Rollback();
                }
            }

            // Now generate whatever output we want.
            AlbumCustomResponse response = new AlbumCustomResponse
            {
                Status = 200
            };
            return response;
        }
    }
</code></pre>

<p>In this particular scenario, we would construct an album object on the mobile client side that directly corresponded
to the JSON we want to push to the database, including the track information.  Let's take a look at a typical call:</p>
<pre><code class="csharp">var response = client.InvokeApiAsync&lt;Album,AlbumCustomResponse&gt;(
    &quot;AlbumController&quot;,              // The name of the API
    newAlbum,                       // The body of the POST
    HttpMethod.Post,                // The HTTP Method
    null,                           // Request Headers
    null);                          // Parameters
</code></pre>

<p>There are <a href="https://github.com/Azure/azure-mobile-apps-net-client/blob/bfe421987a9fabcf82f341355749c64a1eed43c3/src/Microsoft.WindowsAzure.MobileServices/IMobileServiceClient.cs#L186">quite a few signatures</a> for the <code>InvokeApiAsync&lt;&gt;()</code> method.  This one sends an <code>Album</code> object as JSON as the
body of the request, and returns an <code>AlbumCustomResponse</code>, decoding the response as it goes.</p>
<h2 id="the-downside-of-custom-apis">The Downside of Custom APIs<a class="headerlink" href="#the-downside-of-custom-apis" title="Permanent link">&para;</a></h2>
<p>Given that we can do transaction processing within a custom API, one might be forgiven for wondering why we don't
use custom APIs for processing data within our normalized SQL schema.  The problem, of course, is that custom APIs
(including WebAPIs) can only be executed while connected to the Internet.  When the mobile device is offline, the
custom API cannot be executed, thus breaking our offline model.  Offline just doesn't mix with SQL relationships.</p>
<p>When I first encountered this, I thought a great idea may be to instantiate a queue, much like the Operations Queue
that is used within the offline sync process.  When I want to queue up a transaction, I insert it into my own
operations queue.  My early research used a light-weight queuing mechanism (<a href="http://www.codeproject.com/Articles/193611/DotNetMQ-A-Complete-Message-Queue-System-for-NET">DotNetMQ</a>, for those interested) to
implement the queue.  Transactions were inserted into the queue at the appropriate time in the client.  During the
sync process, the transactions were pushed, then the tables were pulled.  The problem is that the tables in the
offline sync were not maintained until a pull, resulting in "old data".  If I updated the data in the offline cache
as well, I produced many conflicts and inconsistent data within the offline cache.  In the end, I concluded that
it was better to loosely couple the tables that were being used (as we discussed in <a href="../../chapter3/relationships/">chapter 3</a>).</p>
<!-- Images -->

<!-- URLs -->
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../options/" title="Options for Server Code" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Options for Server Code
              </span>
            </div>
          </a>
        
        
          <a href="../webjobs/" title="WebJobs" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                WebJobs
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 Adrian Hall
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/adrianhall" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/FizzyInTheHall" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.a353778b.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../js/highlight.pack.js"></script>
      
    
  </body>
</html>